<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
 * Copyright 2024 Adobe
 * All Rights Reserved.
 */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="AssertGroupedProductQtyOnProductPageTest">
        <annotations>
            <title value="Validate quantity in Storefront with group product"/>
            <stories value="ACP2E-3469: Validation Error Triggered for All Products in Group When One Has Invalid Quantity"/>
            <description value="Products in group should not show error for all Products when one Has invalid quantity"/>
            <features value="GroupedProduct"/>
            <testCaseId value="AC-13508"/>
            <severity value="MINOR"/>
        </annotations>
        <before>
            <!--Create simple and grouped product-->
            <createData entity="ApiProductWithDescription" before="simple2" stepKey="simple1"/>
            <createData entity="ApiProductWithDescription" before="groupedProduct" stepKey="simple2"/>
            <createData entity="ApiGroupedProduct" stepKey="groupedProduct"/>
            <createData entity="OneSimpleProductLink" stepKey="addProductOne">
                <requiredEntity createDataKey="groupedProduct"/>
                <requiredEntity createDataKey="simple1"/>
            </createData>
            <updateData entity="OneMoreSimpleProductLink" createDataKey="addProductOne" stepKey="addProductTwo">
                <requiredEntity createDataKey="groupedProduct"/>
                <requiredEntity createDataKey="simple2"/>
            </updateData>
        </before>
        <after>
            <deleteData createDataKey="simple1" before="deleteSimple2" stepKey="deleteSimple1"/>
            <deleteData createDataKey="simple2" before="deleteGroupProduct" stepKey="deleteSimple2"/>
            <deleteData createDataKey="groupedProduct" stepKey="deleteGroupProduct"/>
        </after>
        <!-- Go to storefront home page -->
        <actionGroup ref="StorefrontOpenHomePageActionGroup" stepKey="goToHomepage"/>
        <!-- Check Grouped product is visible on the storefront-->
        <actionGroup ref="StorefrontOpenProductPageActionGroup" stepKey="openProductPage">
            <argument name="productUrl" value="$$groupedProduct.custom_attributes[url_key]$$"/>
        </actionGroup>
        <!-- Fill qty for product options-->
        <fillField selector="{{StorefrontProductPageSection.qtyInputWithProduct($simple1.name$)}}" userInput="1" before="addToCart" stepKey="fillQuantityForFirsProduct"/>
        <fillField selector="{{StorefrontProductPageSection.qtyInputWithProduct($simple2.name$)}}" userInput="-1" after="fillQuantityForFirsProduct" stepKey="fillQuantityForSecondProduct"/>
        <!--Add grouped product to cart -->
        <waitForElementClickable selector="{{StorefrontProductPageSection.addToCart}}" stepKey="waitForAddToCart"/>
        <click selector="{{StorefrontProductPageSection.addToCart}}" stepKey="addToCart"/>
        <!-- Asserting product options qty errors-->
        <waitForElementNotVisible selector="{{StorefrontProductInfoMainSection.groupedProductOptionQtyError($simple1.id$)}}" stepKey="firstProductQtyError"/>
        <waitForElementVisible selector="{{StorefrontProductInfoMainSection.groupedProductOptionQtyError($simple2.id$)}}" stepKey="secondProductQtyError"/>
    </test>
</tests>
